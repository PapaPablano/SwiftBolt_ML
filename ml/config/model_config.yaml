# Model Configuration for SwiftBolt ML Pipeline
# IMPORTANT: linear_tree=True enables time series extrapolation

lightgbm:
  # CRITICAL: linear_tree=True enables extrapolation beyond training range
  # Without this, predictions are bounded by training data min/max
  linear_tree: true
  objective: 'regression'
  metric: 'rmse'
  boosting_type: 'gbdt'
  num_leaves: 31
  max_depth: 10
  learning_rate: 0.05
  min_child_samples: 20
  subsample: 0.8
  colsample_bytree: 0.8
  feature_fraction: 0.9
  n_estimators: 100
  verbose: -1

xgboost:
  objective: 'reg:squarederror'
  max_depth: 8
  learning_rate: 0.1
  n_estimators: 100
  subsample: 0.8
  colsample_bytree: 0.8

random_forest:
  n_estimators: 100
  max_depth: 10
  min_samples_split: 5
  min_samples_leaf: 2
  random_state: 42

ensemble:
  # Weights for model ensemble
  weights:
    lightgbm: 0.5
    xgboost: 0.3
    random_forest: 0.2

walk_forward_cv:
  # Number of validation splits
  n_splits: 5
  # Test size in days (M5 Kaggle standard)
  test_size: 28
  # Gap between train/test to prevent leakage
  gap: 0

direct_forecasting:
  # Forecast horizons in days
  horizons: [1, 7, 14, 28]
  # Use parallel training for speed
  parallel_training: true

supertrend_ai:
  # ATR period for volatility calculation
  atr_length: 10
  # ATR multiplier range to test
  min_multiplier: 1.0
  max_multiplier: 5.0
  step: 0.5
  # Performance smoothing factor
  perf_alpha: 10
  # Cluster selection: Best, Average, Worst
  from_cluster: 'Best'
  # K-means max iterations
  max_iter: 1000

multi_indicator_signals:
  # Indicator weights (should sum to 1.0)
  weights:
    rsi: 0.15
    macd: 0.15
    kdj: 0.15
    adx: 0.10
    bollinger: 0.10
    volume: 0.10
    supertrend: 0.25
  # Signal thresholds
  buy_threshold: 0.3
  sell_threshold: -0.3

drift_detection:
  # Significance level for KS test
  significance_level: 0.05
  # Percentage of drifted features to trigger retraining
  drift_threshold: 0.1

# ============================================================================
# Options Momentum Ranking Configuration
# ============================================================================

options_momentum:
  # Base framework weights (sum to 1.0)
  base_weights:
    momentum: 0.40
    value: 0.35
    greeks: 0.25

  # 7-day underlying metrics feature weights
  # These augment the momentum score with underlying price context
  underlying_7d_metrics:
    enabled: true
    # Weight applied to underlying metrics within momentum calculation
    weight_in_momentum: 0.20
    # Individual feature contributions (sum to 1.0)
    feature_weights:
      return_7d: 0.40      # 7-day price return
      volatility_7d: 0.30  # 7-day annualized volatility
      drawdown_7d: 0.20    # Maximum drawdown over 7 days
      gap_count: 0.10      # Number of significant gaps

    # Regime-specific multipliers
    # Applied when market is in specific trend/volatility regime
    regime_multipliers:
      bullish_low_vol:
        return_7d: 1.2
        volatility_7d: 0.8
        drawdown_7d: 0.9
        gap_count: 0.7
      bullish_high_vol:
        return_7d: 1.0
        volatility_7d: 1.2
        drawdown_7d: 1.1
        gap_count: 1.0
      bearish_low_vol:
        return_7d: 0.8
        volatility_7d: 0.9
        drawdown_7d: 1.2
        gap_count: 0.8
      bearish_high_vol:
        return_7d: 0.9
        volatility_7d: 1.3
        drawdown_7d: 1.3
        gap_count: 1.1
      neutral:
        return_7d: 1.0
        volatility_7d: 1.0
        drawdown_7d: 1.0
        gap_count: 1.0

  # Thresholds for 7-day metrics scoring
  scoring_thresholds:
    # Return thresholds (percentage)
    return_excellent: 10.0    # >10% = excellent momentum
    return_good: 5.0          # >5% = good momentum
    return_poor: -5.0         # <-5% = poor momentum
    return_terrible: -10.0    # <-10% = terrible momentum

    # Volatility thresholds (annualized percentage)
    volatility_low: 15.0      # <15% = low volatility
    volatility_normal: 30.0   # 15-30% = normal
    volatility_high: 50.0     # >50% = high volatility

    # Drawdown thresholds (percentage)
    drawdown_minor: 3.0       # <3% = minor drawdown
    drawdown_moderate: 7.0    # 3-7% = moderate
    drawdown_severe: 15.0     # >15% = severe drawdown

    # Gap count thresholds
    gaps_few: 1               # <=1 gap = stable
    gaps_moderate: 3          # 2-3 gaps = some discontinuity
    gaps_many: 5              # >5 gaps = high discontinuity
